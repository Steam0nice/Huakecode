document.addEventListener("DOMContentLoaded",()=>{const e=e=>window.btoa(unescape(encodeURIComponent(e))),t=e=>decodeURIComponent(escape(window.atob(e))),a=$(".Xc_detail").attr("data-cid");$.ajax({url:Xc.BASE_API,type:"POST",dataType:"json",data:{routeType:"baidu_record",site:window.location.href},success(e){if(e.data&&"已收录"===e.data)$("#Xc_Baidu_Record").css("color","#67C23A"),$("#Xc_Baidu_Record").html("已收录");else if(Xc.BAIDU_PUSH){$("#Xc_Baidu_Record").html('<span style="color: #E6A23C">未收录，推送中...</span>');const e=setTimeout(function(){$.ajax({url:Xc.BASE_API,type:"POST",dataType:"json",data:{routeType:"baidu_push",domain:window.location.protocol+"//"+window.location.hostname,url:encodeURI(window.location.href)},success(e){e.data.error?$("#Xc_Baidu_Record").html('<span style="color: #F56C6C">推送失败，请检查！</span>'):$("#Xc_Baidu_Record").html('<span style="color: #67C23A">推送成功！</span>')}}),clearTimeout(e)},1e3)}else{const e=`https://ziyuan.baidu.com/linksubmit/url?sitename=${encodeURI(window.location.href)}`;$("#Xc_Baidu_Record").html(`<a target="_blank" href="${e}" rel="noopener noreferrer nofollow" style="color: #F56C6C">未收录，提交收录</a>`)}}}),Prism.highlightAll(),$("pre[class*='language-']").each(function(e,t){let a=$(t).find("code[class*='language-']").text(),o=$('<span class="copy"><i class="fa fa-clone" title="复制"></i></span>');new ClipboardJS(o[0],{text:()=>a}).on("success",()=>Qmsg.success("复制成功！")),$(t).append(o)}),$(".Xc_detail_article img:not(img.owo_image)").each(function(){$(this).wrap($(`<span style="display: block;" data-fancybox="Xc" href="${$(this).attr("src")}"></span>`))}),$(".Xc_detail_article a:not(.Xc_detail_article-anote)").each(function(){$(this).attr({target:"_blank",rel:"noopener noreferrer nofollow"})});{let o=localStorage.getItem(e("views"))?JSON.parse(t(localStorage.getItem(e("views")))):[];const i=o.includes(a);i||$.ajax({url:Xc.BASE_API,type:"POST",dataType:"json",data:{routeType:"handle_views",cid:a},success(t){if(1!==t.code)return;$("#Xc_Article_Views").html(`${t.data.views} 阅读`),o.push(a);const i=e("views"),s=e(JSON.stringify(o));localStorage.setItem(i,s)}})}{let o=localStorage.getItem(e("agree"))?JSON.parse(t(localStorage.getItem(e("agree")))):[];o.includes(a)?$(".Xc_detail_agree .icon-1").addClass("active"):$(".Xc_detail_agree .icon-2").addClass("active");let i=!1;$(".Xc_detail_agree .icon").on("click",function(){if(i)return;i=!0,o=localStorage.getItem(e("agree"))?JSON.parse(t(localStorage.getItem(e("agree")))):[];let s=o.includes(a);$.ajax({url:Xc.BASE_API,type:"POST",dataType:"json",data:{routeType:"handle_agree",cid:a,type:s?"disagree":"agree"},success(t){if(1!==t.code)return;if($(".Xc_detail_agree .text").html(t.data.agree),s){const e=o.findIndex(e=>e===a);o.splice(e,1),$(".Xc_detail_agree .icon-1").removeClass("active"),$(".Xc_detail_agree .icon-2").addClass("active"),$(".Xc_detail_agree .icon").removeClass("active")}else o.push(a),$(".Xc_detail_agree .icon-2").removeClass("active"),$(".Xc_detail_agree .icon-1").addClass("active"),$(".Xc_detail_agree .icon").addClass("active");const i=e("agree"),l=e(JSON.stringify(o));localStorage.setItem(i,l)},complete(){i=!1}})})}{let e=!1;$(".Xc_detail_article-protected").on("submit",function(t){t.preventDefault();const o=$(this).attr("action")+"&time="+ +new Date,i=$(this).find('input[type="password"]').val();if(""===i.trim())return Qmsg.info("请输入访问密码！");e||(e=!0,$.ajax({url:o,type:"POST",data:{cid:a,protectCID:a,protectPassword:i},dataType:"text",success(t){let a=[],o="";a=$(t).contents(),Array.from(a).forEach(e=>{"container"===e.parentNode.className&&(o=e)}),/Xc/.test(t)?location.reload():(Qmsg.warning(o.textContent.trim()||""),e=!1,$(".Xc_comment_respond-form .foot .submit button").html("发表评论"))}}))})}if($(".Xc_detail_article-video").length>0){const e=$(".Xc_detail_article-video .play iframe").attr("data-player");$(".Xc_detail_article-video .episodes .item").on("click",function(){$(this).addClass("active").siblings().removeClass("active");const t=$(this).attr("data-src");$(".Xc_detail_article-video .play iframe").attr({src:e+t})}),$(".Xc_detail_article-video .episodes .item").first().click()}$(".Xc_detail_operate-share").length&&($(".Xc_detail_operate-share > svg").on("click",e=>{e.stopPropagation(),$(".Xc_detail_operate-share").toggleClass("active")}),$(document).on("click",()=>$(".Xc_detail_operate-share").removeClass("active")))}),window.addEventListener("load",function(){{const e=new URLSearchParams(location.search).get("scroll");if(e){const t=$(".Xc_header").height();let a=null;if(a=$("#"+e).length>0?$("#"+e):$("."+e),a&&a.length>0){const e=a.offset().top-t-15;window.scrollTo({top:e,behavior:"smooth"})}}}});